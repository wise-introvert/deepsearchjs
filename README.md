## deepsearchjs

[![build](https://github.com/wise-introvert/deepsearchjs/actions/workflows/npm-publish.yml/badge.svg)](https://github.com/wise-introvert/deepsearchjs/workflows/npm-publish.yml)
[![test](https://github.com/wise-introvert/deepsearchjs/actions/workflows/test.yml/badge.svg)](https://github.com/wise-introvert/deepsearchjs/workflows/test.yml)

Search for key in deeply-nested objects.

### Installation

```bash
$ yarn add deepsearchjs
```

### Usage

```ts
search<T>(object: T, any> | Array<any>, searchTerm: string): P;
```

| Name         | Description                                                                                                                      | Required | Type                                                                                                              |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------- | -------- | ----------------------------------------------------------------------------------------------------------------- |
| `object`     | Object to be searched                                                                                                            | True     | `T = Record<any, any> \| Array<any>`                                                                              |
| `searchTerm` | string to search for, a function that determines if an object key matches the query, or a regular expression to use for matching | True     | `string` or `((key: string, value: any) => boolean)` or `RegExp`                                                  |
| output       | Output object                                                                                                                    | ---      | `P = Record<key: string, any>`<br /><small>Where, `key` is a valid object path(eg. `a.b.c[0].d.e`, etc..)</small> |

### Parameters

- `obj` (`T`): The object to search. It is also generic, meaning it can accept any type of object.
- `query` (`string` | `((key: string, value: any) => boolean)` | `RegExp`): The query to search for. This can be a string, a function, or a regular expression.
  - If it is a string, the function will search for keys that end with that string.
  - If it is a function, it will determine if the key matches the query.
  - If it is a regular expression, it will test the key against that regular

### Example

<details>
  <summary>sample data</summary>
  <pre>
{
  "users": [
    {
      "id": 39101,
      "name": "Edwin Reichel",
      "email": "Kirk.Bednar@yahoo.com",
      "address": {
        "street": "1709 Carole Branch",
        "city": "Jenkinsboro",
        "state": "TX",
        "zip": "61317-0976",
        "phoneNumbers": [
          { "type": "work", "number": "232.844.3064 x29733" },
          { "type": "work", "number": "950.846.8118 x9126" }
        ],
        "previousAddresses": [
          {
            "street": "82002 Connelly Dale",
            "city": "Folsom",
            "state": "MS",
            "zip": "20367-6986",
            "yearsLived": 10,
            "phoneNumbers": [{ "type": "work", "number": "1-997-352-5842" }],
            "previousAddresses": [
              {
                "street": "663 Emie Way",
                "city": "Gradyton",
                "state": "OH",
                "zip": "09828-8254",
                "yearsLived": 5
              },
              {
                "street": "1991 Consuelo Roads",
                "city": "Gusbury",
                "state": "KY",
                "zip": "69719",
                "yearsLived": 1
              }
            ]
          }
        ]
      },
      "orders": [
        {
          "id": 15686,
          "date": "Sun Jan 22 2023 15:36:15 GMT-0500 (Eastern Standard Time)",
          "total": 83285,
          "items": [
            {
              "name": "Incredible Metal Shoes",
              "quantity": 1,
              "price": "469.00"
            },
            {
              "name": "Unbranded Concrete Chair",
              "quantity": 6,
              "price": "999.00"
            },
            {
              "name": "Licensed Concrete Sausages",
              "quantity": 9,
              "price": "657.00"
            },
            {
              "name": "Electronic Rubber Ball",
              "quantity": 7,
              "price": "117.00"
            }
          ],
          "shippingAddress": {
            "street": "034 Wiza Forge",
            "city": "Glenniemouth",
            "state": "VT",
            "zip": "60082-4617"
          }
        }
      ]
    },
    {
      "id": 41973,
      "name": "Melanie Upton",
      "email": "Alisha.Boyle@yahoo.com",
      "address": {
        "street": "69147 Bode Junctions",
        "city": "Bakersfield",
        "state": "WA",
        "zip": "83859",
        "phoneNumbers": [
          { "type": "home", "number": "(263) 786-2737 x719" },
          { "type": "home", "number": "1-536-445-2960" }
        ],
        "previousAddresses": [
          {
            "street": "99456 Elliott Corner",
            "city": "Joanneburgh",
            "state": "ME",
            "zip": "41321",
            "yearsLived": 9,
            "phoneNumbers": [
              { "type": "work", "number": "(999) 243-1101" },
              { "type": "work", "number": "353.548.4339 x89335" }
            ],
            "previousAddresses": [
              {
                "street": "591 Thomas Way",
                "city": "New Richmond",
                "state": "OH",
                "zip": "19873",
                "yearsLived": 3
              },
              {
                "street": "215 Shanahan Crescent",
                "city": "South Clarissa",
                "state": "MS",
                "zip": "31746",
                "yearsLived": 2
              }
            ]
          }
        ]
      },
      "orders": [
        {
          "id": 21059,
          "date": "Sun Jan 22 2023 11:09:50 GMT-0500 (Eastern Standard Time)",
          "total": 38281,
          "items": [
            { "name": "Rustic Frozen Shirt", "quantity": 3, "price": "797.00" },
            {
              "name": "Luxurious Fresh Salad",
              "quantity": 3,
              "price": "290.00"
            },
            {
              "name": "Ergonomic Bronze Pizza",
              "quantity": 10,
              "price": "380.00"
            }
          ],
          "shippingAddress": {
            "street": "35692 Miller Locks",
            "city": "Bowie",
            "state": "TN",
            "zip": "40565-6785"
          }
        }
      ]
    }
  ]
}
</pre>
</details>

#### **`index.ts`**

```ts
import { search } from "deepsearchjs";
import data from "./data.json";

// string as query
search(data, "city");

// call back function as query
search(data, (key: string, value: string): boolean => /city/gi.test(key));

// regex as query
search(data, /city/gi);

/*
 * All three calls will have the same output:
 * {
 *   "users[0].address.city": "Jenkinsboro",
 *   "users[0].address.previousAddresses[0].city": "Folsom",
 *   ...
 * }
 */
```

### TODO

- [ ] ci/cd: Automate versioning and releases
- [ ] feat: Optimize search algorithm to handle oversized datasets
- [ ] feat: Add a third parameter to the function to customize the search parameters ( leaf-node results only, etc... )
- [ ] feat: Search across values??

### Benchmark
- text-based search x 19,894 ops/sec ±2.14% (92 runs sampled)
- regex-based search x 26,601 ops/sec ±0.72% (89 runs sampled)
- cb-based search x 7,868 ops/sec ±2.44% (90 runs sampled)

    	- Fastest method ( for the current release ): regex-based search :sparkles::tada:!!
<details> <summary>JSON results</summary> <pre>{
  "0": {
    "name": "text-based search",
    "options": {
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05
    },
    "async": false,
    "defer": false,
    "delay": 0.005,
    "initCount": 1,
    "maxTime": 5,
    "minSamples": 5,
    "minTime": 0.05,
    "id": 1,
    "stats": {
      "moe": 0.0000010753360451307136,
      "rme": 2.139245606457556,
      "sem": 5.486408393524049e-7,
      "deviation": 0.000005262378064686026,
      "mean": 0.00005026706806757903,
      "sample": [
        0.00009326707814761216,
        0.00006022736868686869,
        0.00004850442760617761,
        0.000048519051158301154,
        0.00004881876737451738,
        0.00004842882788461538,
        0.00004901035865384615,
        0.000048680762500000004,
        0.00006051273076923077,
        0.00004825843846153846,
        0.000048971310576923075,
        0.00005027744807692307,
        0.00005039243461538462,
        0.00005100940096153846,
        0.00006596911442307692,
        0.00005286074230769231,
        0.000048503988461538464,
        0.000052739174999999996,
        0.00005144319038461538,
        0.000050164093269230775,
        0.00004859676538461539,
        0.00004854417754318618,
        0.000049124886756238005,
        0.00004889009404990403,
        0.000056144326295585416,
        0.0000499636142034549,
        0.00004921697120921305,
        0.00005042984932821497,
        0.00004908851439539347,
        0.00005073536276391555,
        0.00005089919289827255,
        0.000049063009596928986,
        0.000048501896353166985,
        0.00004875932437619962,
        0.00004956102879078695,
        0.00004976401919385797,
        0.00004884624664107485,
        0.00005142861420345489,
        0.00004849007197696737,
        0.00004881940690978887,
        0.00004875246641074856,
        0.00004904310460652591,
        0.000048766113243762,
        0.00004895225335892514,
        0.00004850863531669866,
        0.000048776593090211134,
        0.000048580135316698655,
        0.0000485424443378119,
        0.00004988065163147793,
        0.000049213866602687144,
        0.0000487066660268714,
        0.00004833322936660268,
        0.000048478969289827254,
        0.00004894606857142857,
        0.000048654829523809525,
        0.00004889902380952381,
        0.000047943253333333333,
        0.00004906339523809524,
        0.00004872531047619048,
        0.00004889191142857143,
        0.00004829076571428571,
        0.00004799615238095238,
        0.00005008060095238095,
        0.00004827122380952381,
        0.000048653835238095236,
        0.000050269359999999994,
        0.00004922048571428571,
        0.000049122559047619044,
        0.000048243442857142856,
        0.00004836686,
        0.00004827430285714286,
        0.000048908778095238096,
        0.00004857747523809524,
        0.00004944137238095238,
        0.00004761933142857143,
        0.00004940716666666667,
        0.00004925468666666667,
        0.00004934704476190476,
        0.00005020066380952381,
        0.000048448938095238094,
        0.0000492772219047619,
        0.00004825953904761905,
        0.00004970259428571428,
        0.0000500546,
        0.00005389880380952381,
        0.00005003709619047619,
        0.00004991746095238095,
        0.000048590130476190474,
        0.000050143541904761906,
        0.000050641067619047614,
        0.00004924605333333333,
        0.000049722103809523805
      ],
      "variance": 2.769262289568865e-11
    },
    "times": {
      "cycle": 0.05278042147095798,
      "elapsed": 5.5,
      "period": 0.00005026706806757903,
      "timeStamp": 1679993555371
    },
    "running": false,
    "count": 1050,
    "cycles": 4,
    "hz": 19893.74034418718
  },
  "1": {
    "name": "regex-based search",
    "options": {
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05
    },
    "async": false,
    "defer": false,
    "delay": 0.005,
    "initCount": 1,
    "maxTime": 5,
    "minSamples": 5,
    "minTime": 0.05,
    "id": 2,
    "stats": {
      "moe": 2.7170629637151495e-7,
      "rme": 0.722778396944595,
      "sem": 1.3862566141403823e-7,
      "deviation": 0.0000013077918741989038,
      "mean": 0.00003759192271380833,
      "sample": [
        0.000037977803018867926,
        0.000037856168301886795,
        0.000037801714716981134,
        0.00004164854867924528,
        0.00003733328288023512,
        0.00003686563262307127,
        0.000038322605437178544,
        0.000039023804555473915,
        0.00003674496473181484,
        0.000036788778754578755,
        0.000040361445175438595,
        0.00003822686476608187,
        0.000037054576754385964,
        0.000039879488304093567,
        0.000042685820175438594,
        0.00003735515570175439,
        0.00003735407236842105,
        0.00003721134283625731,
        0.00003673569247626004,
        0.000037149061358655955,
        0.00003795058802045289,
        0.00003747328049671293,
        0.000037141603360116876,
        0.000036784504017531045,
        0.00003678849890430972,
        0.00003663798100803506,
        0.000036691292184075964,
        0.000037000384222059894,
        0.000036906892935178444,
        0.000036719975236707944,
        0.00003710332556445739,
        0.00003806986744355426,
        0.000037032032046613254,
        0.000036980742170429715,
        0.00003654052367079388,
        0.00003759932629278951,
        0.00003723110269482885,
        0.000040142557174071376,
        0.000037157900218499635,
        0.000037073200291332845,
        0.000037051096868171885,
        0.00003671801966496723,
        0.00003704672978878368,
        0.0000367521975308642,
        0.000036824492374727665,
        0.00003662433986928105,
        0.00003693018373275236,
        0.00003843630501089325,
        0.000037063497458242555,
        0.000040455156862745095,
        0.00004142459259259259,
        0.00003709717792302106,
        0.000041575999999999996,
        0.00003673671241830066,
        0.00003685291140159768,
        0.00003718869135802469,
        0.000039212216412490924,
        0.00003776820551924474,
        0.00003685421859114016,
        0.00003648282788671024,
        0.00003656810965867828,
        0.00003687277487291213,
        0.000036440494553376905,
        0.000037105552650689905,
        0.00003634169353667393,
        0.00003758967175018155,
        0.00003800369934640523,
        0.00003851544517066085,
        0.000040021011619462596,
        0.00003673803776325345,
        0.00003967117647058824,
        0.00003673711183732752,
        0.00003716597312999274,
        0.000036806307189542486,
        0.0000379742091503268,
        0.000037013550472040664,
        0.00003775689978213508,
        0.00003706916339869281,
        0.00003766927015250544,
        0.00003695061147421932,
        0.000037263529411764704,
        0.00003684749237472767,
        0.0000366469767610748,
        0.00003722839796659405,
        0.00003718626434277415,
        0.00003699567320261438,
        0.00003641881554103123,
        0.00003698909005083515,
        0.00003659614306463326
      ],
      "variance": 1.7103195862206813e-12
    },
    "times": {
      "cycle": 0.051764077576914064,
      "elapsed": 5.37,
      "period": 0.00003759192271380833,
      "timeStamp": 1679993560872
    },
    "running": false,
    "count": 1377,
    "cycles": 4,
    "hz": 26601.45924466583
  },
  "2": {
    "name": "cb-based search",
    "options": {
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05
    },
    "async": false,
    "defer": false,
    "delay": 0.005,
    "initCount": 1,
    "maxTime": 5,
    "minSamples": 5,
    "minTime": 0.05,
    "id": 3,
    "stats": {
      "moe": 0.000003098838797389041,
      "rme": 2.438094481970004,
      "sem": 0.0000015810402027495106,
      "deviation": 0.000014999064338948587,
      "mean": 0.00012710084946688157,
      "sample": [
        0.00013039701776649748,
        0.00012762728172588834,
        0.00013072811675126904,
        0.00012873854060913706,
        0.0001297147575757576,
        0.00012935314393939393,
        0.00013180627525252525,
        0.00013097083050847457,
        0.00012396282082324456,
        0.0001221239273607748,
        0.0001234249515738499,
        0.00012207558595641647,
        0.00012279515625,
        0.00012290593028846153,
        0.00012221952163461538,
        0.00012108080528846154,
        0.00012253667307692307,
        0.0001315316610576923,
        0.00012226429807692308,
        0.00013015586778846155,
        0.00012173312980769231,
        0.00012219077884615385,
        0.00012286609615384616,
        0.00012234834375,
        0.00012198780528846153,
        0.00012079319951923076,
        0.00012135998557692308,
        0.00012267509134615383,
        0.0001230482235576923,
        0.00012136846875,
        0.0001231572283653846,
        0.00012182169230769232,
        0.00012609035096153846,
        0.0001227490673076923,
        0.00012109023317307692,
        0.00012501599278846154,
        0.00012359132692307692,
        0.00012398944471153845,
        0.00012198336298076922,
        0.00012095745673076924,
        0.00012093405769230768,
        0.000123003375,
        0.00012201679086538462,
        0.00012048906490384615,
        0.00012183466105769231,
        0.00012341777403846154,
        0.00012185434134615385,
        0.00012281874038461537,
        0.00012183860576923077,
        0.00012105141346153847,
        0.00012155242788461538,
        0.00012274930048076924,
        0.00012230844951923077,
        0.00012122974038461539,
        0.00012583739423076924,
        0.00012216279326923075,
        0.00014839879567307693,
        0.0002430662091346154,
        0.0001567039855769231,
        0.00014093026201923077,
        0.00012804774519230768,
        0.00012680165625,
        0.00013256409615384614,
        0.00013080502644230769,
        0.0001298231201923077,
        0.00012909611778846153,
        0.00012904276442307692,
        0.0001277240985576923,
        0.00012855240625,
        0.00012362478605769232,
        0.00012651566586538462,
        0.00018561806250000002,
        0.00012290456730769232,
        0.00012335626682692308,
        0.00012370194019138757,
        0.0001217859066985646,
        0.00012335627751196174,
        0.0001203654928229665,
        0.00012285438038277512,
        0.00012682046411483254,
        0.00012216395215311005,
        0.00012248423205741627,
        0.00012146467464114833,
        0.00012236853827751198,
        0.00012052797607655501,
        0.00012268154545454544,
        0.00012506448086124403,
        0.00013187094976076555,
        0.00012347025598086125,
        0.00012219038038277513
      ],
      "variance": 2.2497193104391924e-10
    },
    "times": {
      "cycle": 0.0531281550771565,
      "elapsed": 5.353,
      "period": 0.00012710084946688157,
      "timeStamp": 1679993566243
    },
    "running": false,
    "count": 418,
    "cycles": 4,
    "hz": 7867.768029831839
  },
  "options": {},
  "length": 3,
  "events": {
    "cycle": [
      null
    ],
    "complete": [
      null
    ]
  },
  "running": false
}</pre> </details>
  

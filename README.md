## deepsearchjs

[![build](https://github.com/wise-introvert/deepsearchjs/actions/workflows/npm-publish.yml/badge.svg)](https://github.com/wise-introvert/deepsearchjs/workflows/npm-publish.yml)
[![test](https://github.com/wise-introvert/deepsearchjs/actions/workflows/test.yml/badge.svg)](https://github.com/wise-introvert/deepsearchjs/workflows/test.yml)

Search for key in deeply-nested objects.

### Installation

```bash
$ yarn add deepsearchjs
```

### Usage

```ts
search<T>(object: T, any> | Array<any>, searchTerm: string): P;
```

| Name         | Description                                                                                                                      | Required | Type                                                                                                              |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------- | -------- | ----------------------------------------------------------------------------------------------------------------- |
| `object`     | Object to be searched                                                                                                            | True     | `T = Record<any, any> \| Array<any>`                                                                              |
| `searchTerm` | string to search for, a function that determines if an object key matches the query, or a regular expression to use for matching | True     | `string` or `((key: string, value: any) => boolean)` or `RegExp`                                                  |
| output       | Output object                                                                                                                    | ---      | `P = Record<key: string, any>`<br /><small>Where, `key` is a valid object path(eg. `a.b.c[0].d.e`, etc..)</small> |

### Parameters

- `obj` (`T`): The object to search. It is also generic, meaning it can accept any type of object.
- `query` (`string` | `((key: string, value: any) => boolean)` | `RegExp`): The query to search for. This can be a string, a function, or a regular expression.
  - If it is a string, the function will search for keys that end with that string.
  - If it is a function, it will determine if the key matches the query.
  - If it is a regular expression, it will test the key against that regular

### Example

<details>
  <summary>sample data</summary>
  <pre>
{
  "users": [
    {
      "id": 39101,
      "name": "Edwin Reichel",
      "email": "Kirk.Bednar@yahoo.com",
      "address": {
        "street": "1709 Carole Branch",
        "city": "Jenkinsboro",
        "state": "TX",
        "zip": "61317-0976",
        "phoneNumbers": [
          { "type": "work", "number": "232.844.3064 x29733" },
          { "type": "work", "number": "950.846.8118 x9126" }
        ],
        "previousAddresses": [
          {
            "street": "82002 Connelly Dale",
            "city": "Folsom",
            "state": "MS",
            "zip": "20367-6986",
            "yearsLived": 10,
            "phoneNumbers": [{ "type": "work", "number": "1-997-352-5842" }],
            "previousAddresses": [
              {
                "street": "663 Emie Way",
                "city": "Gradyton",
                "state": "OH",
                "zip": "09828-8254",
                "yearsLived": 5
              },
              {
                "street": "1991 Consuelo Roads",
                "city": "Gusbury",
                "state": "KY",
                "zip": "69719",
                "yearsLived": 1
              }
            ]
          }
        ]
      },
      "orders": [
        {
          "id": 15686,
          "date": "Sun Jan 22 2023 15:36:15 GMT-0500 (Eastern Standard Time)",
          "total": 83285,
          "items": [
            {
              "name": "Incredible Metal Shoes",
              "quantity": 1,
              "price": "469.00"
            },
            {
              "name": "Unbranded Concrete Chair",
              "quantity": 6,
              "price": "999.00"
            },
            {
              "name": "Licensed Concrete Sausages",
              "quantity": 9,
              "price": "657.00"
            },
            {
              "name": "Electronic Rubber Ball",
              "quantity": 7,
              "price": "117.00"
            }
          ],
          "shippingAddress": {
            "street": "034 Wiza Forge",
            "city": "Glenniemouth",
            "state": "VT",
            "zip": "60082-4617"
          }
        }
      ]
    },
    {
      "id": 41973,
      "name": "Melanie Upton",
      "email": "Alisha.Boyle@yahoo.com",
      "address": {
        "street": "69147 Bode Junctions",
        "city": "Bakersfield",
        "state": "WA",
        "zip": "83859",
        "phoneNumbers": [
          { "type": "home", "number": "(263) 786-2737 x719" },
          { "type": "home", "number": "1-536-445-2960" }
        ],
        "previousAddresses": [
          {
            "street": "99456 Elliott Corner",
            "city": "Joanneburgh",
            "state": "ME",
            "zip": "41321",
            "yearsLived": 9,
            "phoneNumbers": [
              { "type": "work", "number": "(999) 243-1101" },
              { "type": "work", "number": "353.548.4339 x89335" }
            ],
            "previousAddresses": [
              {
                "street": "591 Thomas Way",
                "city": "New Richmond",
                "state": "OH",
                "zip": "19873",
                "yearsLived": 3
              },
              {
                "street": "215 Shanahan Crescent",
                "city": "South Clarissa",
                "state": "MS",
                "zip": "31746",
                "yearsLived": 2
              }
            ]
          }
        ]
      },
      "orders": [
        {
          "id": 21059,
          "date": "Sun Jan 22 2023 11:09:50 GMT-0500 (Eastern Standard Time)",
          "total": 38281,
          "items": [
            { "name": "Rustic Frozen Shirt", "quantity": 3, "price": "797.00" },
            {
              "name": "Luxurious Fresh Salad",
              "quantity": 3,
              "price": "290.00"
            },
            {
              "name": "Ergonomic Bronze Pizza",
              "quantity": 10,
              "price": "380.00"
            }
          ],
          "shippingAddress": {
            "street": "35692 Miller Locks",
            "city": "Bowie",
            "state": "TN",
            "zip": "40565-6785"
          }
        }
      ]
    }
  ]
}
</pre>
</details>

#### **`index.ts`**

```ts
import { search } from "deepsearchjs";
import data from "./data.json";

// string as query
search(data, "city");

// call back function as query
search(data, (key: string, value: string): boolean => /city/gi.test(key));

// regex as query
search(data, /city/gi);

/*
 * All three calls will have the same output:
 * {
 *   "users[0].address.city": "Jenkinsboro",
 *   "users[0].address.previousAddresses[0].city": "Folsom",
 *   ...
 * }
 */
```

### TODO

- [ ] ci/cd: Automate versioning and releases
- [ ] feat: Optimize search algorithm to handle oversized datasets
- [ ] feat: Add a third parameter to the function to customize the search parameters ( leaf-node results only, etc... )
- [ ] feat: Search across values??

### Benchmark

- text-based search x 19,979 ops/sec ±1.38% (90 runs sampled)
- regex-based search x 25,102 ops/sec ±3.58% (90 runs sampled)
- cb-based search x 7,859 ops/sec ±0.68% (92 runs sampled)
  - :stopwatch: Fastest method ( for the current release ): regex-based search!!
  <details> <summary>JSON results</summary> <pre>{
    "0": {
      "name": "text-based search",
      "options": {
        "async": false,
        "defer": false,
        "delay": 0.005,
        "initCount": 1,
        "maxTime": 5,
        "minSamples": 5,
        "minTime": 0.05
      },
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05,
      "id": 1,
      "stats": {
        "moe": 6.883578174057686e-7,
        "rme": 1.375241947108574,
        "sem": 3.5120296806416766e-7,
        "deviation": 0.0000033318039002824387,
        "mean": 0.00005005357921586313,
        "sample": [
          0.000060358975308641975,
          0.00004986986470588236,
          0.00004915540784313726,
          0.00004909794509803922,
          0.00004960843823529412,
          0.000052391345098039216,
          0.00004868670582524272,
          0.00004869669708737864,
          0.000049472566019417476,
          0.00005019597961165049,
          0.000049952736893203885,
          0.00005001776019417476,
          0.000048882450485436894,
          0.00004918792718446602,
          0.00004863552330097087,
          0.000050601817475728154,
          0.000049463075728155345,
          0.000049632903883495146,
          0.00005159060582524272,
          0.00004974107572815534,
          0.00004898247766990291,
          0.00004986515048543689,
          0.00004933527087378641,
          0.00004934763203883495,
          0.00005074853689320388,
          0.00005072083300970873,
          0.00004837239961389961,
          0.000049211678571428574,
          0.00004888758397683397,
          0.0000501642306949807,
          0.000049136375482625486,
          0.00005007179922779923,
          0.00005215060135135135,
          0.00004829638416988417,
          0.000048343972007722006,
          0.00004881321911196911,
          0.00004963836872586873,
          0.00004870794787644788,
          0.00004833090540540541,
          0.000048287808880308885,
          0.0000484894812319538,
          0.00004824012415784408,
          0.00007473412223291627,
          0.00004850199326275265,
          0.00004885087199230029,
          0.00004846806711409396,
          0.00004839247075743049,
          0.000048188513902205174,
          0.00004817393205741627,
          0.0000484082976076555,
          0.00004831838660287082,
          0.00004848276746411483,
          0.00004825645933014354,
          0.000048597714832535886,
          0.00004872703732057416,
          0.00004833685167464115,
          0.00005702933684210527,
          0.000051523940669856456,
          0.00005162206794258374,
          0.00004840120861244019,
          0.000048556964593301434,
          0.00005426512535885167,
          0.00005489907655502392,
          0.0000481908928229665,
          0.000051966198086124404,
          0.00004894116650717703,
          0.00004847371004784689,
          0.000048539705263157896,
          0.00004789574641148325,
          0.000049909293779904306,
          0.00004914079043062201,
          0.00004907992248803828,
          0.0000479339990430622,
          0.00004835808133971291,
          0.00004908313588516746,
          0.000050852024880382775,
          0.000054325060287081336,
          0.000049041828708133976,
          0.000055899783732057417,
          0.00005026062966507177,
          0.00005027453301435406,
          0.00005000733875598086,
          0.00004925674641148325,
          0.00004997318181818182,
          0.000049960941626794254,
          0.00004932768995215311,
          0.000049487044976076556,
          0.00004975580478468899,
          0.000049969021052631584,
          0.00004880006794258373
        ],
        "variance": 1.110091722993727e-11
      },
      "times": {
        "cycle": 0.05230599028057697,
        "elapsed": 5.531,
        "period": 0.00005005357921586313,
        "timeStamp": 1679967257725
      },
      "running": false,
      "count": 1045,
      "cycles": 6,
      "hz": 19978.59125493022
    },
    "1": {
      "name": "regex-based search",
      "options": {
        "async": false,
        "defer": false,
        "delay": 0.005,
        "initCount": 1,
        "maxTime": 5,
        "minSamples": 5,
        "minTime": 0.05
      },
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05,
      "id": 2,
      "stats": {
        "moe": 0.0000014245030066813823,
        "rme": 3.5757583445835217,
        "sem": 7.267872483068277e-7,
        "deviation": 0.000006894909237047791,
        "mean": 0.00003983778738401568,
        "sample": [
          0.000037253244852941176,
          0.000037676782352941176,
          0.00003810007573529412,
          0.000037845288970588236,
          0.00003943904926470589,
          0.00003721002205882353,
          0.000036813852205882354,
          0.00003714474780058651,
          0.000044197040322580646,
          0.00003693990542521994,
          0.000040003131964809383,
          0.00003740362463343109,
          0.000037339293255131966,
          0.00003737724560117302,
          0.00004151969134897361,
          0.00003733971994134897,
          0.00003693871187683284,
          0.00003755795234604106,
          0.000044825392228739,
          0.00003705107771260997,
          0.00003687485483870968,
          0.000036848480205278594,
          0.000038684227272727274,
          0.000037304686217008795,
          0.00003694720747800586,
          0.00003681456304985337,
          0.00003697658797653959,
          0.00003686874340175953,
          0.00003805406011730205,
          0.00003812214516129032,
          0.00004176487536656891,
          0.00003677567668621701,
          0.00003755376759530792,
          0.00003735796847507331,
          0.000037035230205278593,
          0.000037412758797653956,
          0.000048477549120234604,
          0.00004092965835777126,
          0.00003685126173020528,
          0.00003866386876832844,
          0.00003681192008797654,
          0.000037281196480938416,
          0.000036949372434017594,
          0.000036802593841642226,
          0.0000368542008797654,
          0.000036819244134897364,
          0.00004279096114369502,
          0.00003700315762463343,
          0.00003695540615835777,
          0.000037661804252199415,
          0.00003740992448680352,
          0.000036887574046920826,
          0.00003733160190615836,
          0.00003736671774193548,
          0.00003740098607038123,
          0.000040089826246334306,
          0.000037040460410557184,
          0.0000372220293255132,
          0.00003707672947214076,
          0.000037298555718475077,
          0.0000407286862170088,
          0.00003822412536656891,
          0.00004083162243401759,
          0.00003751444354838709,
          0.00003700157258064516,
          0.000037107662023460414,
          0.00003707531891495601,
          0.00003722246847507331,
          0.00003687330278592375,
          0.0000367405637829912,
          0.000037107625366568916,
          0.00003738928739002933,
          0.00005653755425219941,
          0.00007425634677419355,
          0.000054147615102639296,
          0.00005316248240469208,
          0.00003806698387096774,
          0.00004073364369501467,
          0.000037134570381231674,
          0.0000546139435483871,
          0.00007252682331378298,
          0.00006214443914956012,
          0.00003862442228739003,
          0.000037412965542521994,
          0.00003706930425219942,
          0.000037510107771260996,
          0.00003832116862170088,
          0.000037699614369501466,
          0.00003724623240469208,
          0.00003702768475073314
        ],
        "variance": 4.7539773387126947e-11
      },
      "times": {
        "cycle": 0.05433874199179738,
        "elapsed": 5.365,
        "period": 0.00003983778738401568,
        "timeStamp": 1679967263257
      },
      "running": false,
      "count": 1364,
      "cycles": 4,
      "hz": 25101.79569865457
    },
    "2": {
      "name": "cb-based search",
      "options": {
        "async": false,
        "defer": false,
        "delay": 0.005,
        "initCount": 1,
        "maxTime": 5,
        "minSamples": 5,
        "minTime": 0.05
      },
      "async": false,
      "defer": false,
      "delay": 0.005,
      "initCount": 1,
      "maxTime": 5,
      "minSamples": 5,
      "minTime": 0.05,
      "id": 3,
      "stats": {
        "moe": 8.703864487420351e-7,
        "rme": 0.6840171100253313,
        "sem": 4.440747187459363e-7,
        "deviation": 0.000004259415069735982,
        "mean": 0.00012724629778775593,
        "sample": [
          0.00013143122139303484,
          0.00012614572388059702,
          0.0001267536287128713,
          0.00012766753712871285,
          0.00013552989356435644,
          0.00012502002722772275,
          0.00013095360643564357,
          0.00014186255198019802,
          0.00012838200742574258,
          0.00012661299257425742,
          0.00012800144801980199,
          0.00013257469554455446,
          0.00012932897277227723,
          0.00012761549752475247,
          0.00012393821782178218,
          0.00012718183663366336,
          0.00012746233663366336,
          0.00012976288366336634,
          0.0001290696683168317,
          0.00012640740346534654,
          0.00012588776237623762,
          0.00012595315099009902,
          0.00012722426732673266,
          0.00012881444306930693,
          0.00012625281930693069,
          0.0001273760396039604,
          0.0001290458910891089,
          0.000126911948019802,
          0.0001396530891089109,
          0.0001287630618811881,
          0.00013780911633663365,
          0.00013289198267326733,
          0.000126344599009901,
          0.0001283548118811881,
          0.00012964520544554454,
          0.00012826303712871288,
          0.00012565634653465346,
          0.0001243124938271605,
          0.00012539193580246913,
          0.00012384284691358024,
          0.00012348398271604937,
          0.00012543734567901235,
          0.00012369956790123457,
          0.00012407325925925926,
          0.00012369168148148148,
          0.00012428292839506173,
          0.00012511543703703704,
          0.00013408408641975308,
          0.00012806222962962962,
          0.00012416438349514562,
          0.0001238340072815534,
          0.00012539204368932039,
          0.00012459174637681158,
          0.00012447809420289854,
          0.00012242159420289855,
          0.00013834863526570047,
          0.00012575317874396135,
          0.00012606503623188405,
          0.0001239271570048309,
          0.00012560438405797103,
          0.0001261292608695652,
          0.00012362519806763286,
          0.00012813742753623188,
          0.00012497515700483092,
          0.00012501657487922705,
          0.00012145214734299516,
          0.00012510671014492755,
          0.00012858533574879226,
          0.00014632734541062802,
          0.00012406116666666668,
          0.00012404847584541063,
          0.00012409982850241546,
          0.00013208499516908213,
          0.00012409644685990338,
          0.0001246627971014493,
          0.0001222111304347826,
          0.00012471524396135265,
          0.00012565050966183576,
          0.00012345084541062802,
          0.00012175042270531402,
          0.00013071943478260869,
          0.00012805791787439614,
          0.00012678766666666667,
          0.0001268470724637681,
          0.00012537113526570049,
          0.0001243772801932367,
          0.00012556136714975846,
          0.00012647892512077295,
          0.00012610150483091786,
          0.0001256516739130435,
          0.00012595955314009664,
          0.00012795106763285026
        ],
        "variance": 1.8142616736293974e-11
      },
      "times": {
        "cycle": 0.052679967284130956,
        "elapsed": 5.422,
        "period": 0.00012724629778775593,
        "timeStamp": 1679967268622
      },
      "running": false,
      "count": 414,
      "cycles": 5,
      "hz": 7858.774812199082
    },
    "options": {},
    "length": 3,
    "events": {
      "cycle": [
        null
      ],
      "complete": [
        null
      ]
    },
    "running": false
  }</pre> </details>
